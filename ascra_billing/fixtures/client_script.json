[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Issue Voucher",
  "enabled": 0,
  "modified": "2025-01-07 11:35:51.469558",
  "module": null,
  "name": "Sales Issue Voucher",
  "script": "frappe.ui.form.on('Sales Issue Voucher', {\n\trefresh(frm) {\n\t    frappe.call({\n       \t\tmethod: \"get_address_by_account_code\",\n        \t\targs: {\n        \t\t    account_code : frm.doc.account_code\n        \t\t},\n        \t\tcallback: (r)=> {\n        \t\tvar address = r.message;\n        \t\tfrm.set_query(\"sub_account\", function() {\n                    return {\n                        filters: {\n            \t\t\t\t\tname: [\"in\", address],\n            \t\t\t},\n                    };\n                });\n        \t\t}\n\t        });\n\t        \n\t\t\n\t},\n\t\n\taccount_code(frm) {\n\t    frappe.call({\n       \t\tmethod: \"get_address_by_account_code\",\n        \t\targs: {\n        \t\t    account_code : frm.doc.account_code\n        \t\t},\n        \t\tcallback: (r)=> {\n        \t\tvar address = r.message;\n        \t\tfrm.set_query(\"sub_account\", function() {\n                    return {\n                        filters: {\n            \t\t\t\t\tname: [\"in\", address],\n            \t\t\t},\n                    };\n                });\n        \t\t}\n\t        });\n\t        \n\t\t\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2025-01-16 16:10:21.426861",
  "module": null,
  "name": "Sales Invoice List View",
  "script": "frappe.listview_settings['Sales Invoice'] = {\n    button: {\n        show: function(doc) {\n            return true;\n        },\n        get_label: function() {\n            return __('<i class=\"fa fa-file-pdf-o\" style=\"font-size:18px;color:red\"></i>');\n        },\n        get_description: function(doc) {\n            return __('Print {0}', [doc.name])\n        },\n        action: function(doc) {\n            //frappe.set_route(\"/app/print/Purchase Invoice/\" + doc.name);\n            \n            var objWindowOpenResult = window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n              + \"doctype=\" + encodeURIComponent(\"Sales Invoice\")\n              + \"&name=\" + encodeURIComponent(doc.name)\n              + \"&trigger_print=0\"\n              + \"&format=Test Issue Voucher(Delivery Challan)\"\n              + \"&no_letterhead=0\"\n              + \"&_lang=en\"\n            ));\n\n            if(!objWindowOpenResult) {\n              msgprint(__(\"Please set permission for pop-up windows in your browser!\")); return;\n            }\n        }\n    },\n    \n    onload: function (listview) {\n        listview.page.add_action_item(__('Open in View-Only'), function () {\n            // Get the selected records\n            const selected = listview.get_checked_items();\n\n            // Validate that exactly one record is selected\n            if (selected.length !== 1) {\n                frappe.msgprint(__('Please select exactly one record to open in view-only mode.'));\n                return;\n            }\n\n            const docname = selected[0].name;\n\n            // Open the selected record in view-only mode\n            frappe.set_route('Form', 'Sales Invoice', docname).then(() => {\n                frappe.ui.form.on('Sales Invoice', 'refresh', function (frm) {\n                    // Set the main form to read-only\n                    frm.set_read_only();\n\n                    // Make the 'items' child table read-only\n                    if (frm.fields_dict.items && frm.fields_dict.items.grid) {\n                        frm.fields_dict.items.grid.make_read_only();\n                    }\n\n                    // Make the 'taxes' child table read-only\n                    if (frm.fields_dict.taxes && frm.fields_dict.taxes.grid) {\n                        frm.fields_dict.taxes.grid.make_read_only();\n                    }\n                });\n            });\n        });\n        \n        // Add \"Print Record\" Button\n        listview.page.add_action_item(__('Print Record'), function () {\n            // Get the selected records\n            const selected = listview.get_checked_items();\n\n            // Validate that exactly one record is selected\n            if (selected.length !== 1) {\n                frappe.msgprint(__('Please select exactly one record to print.'));\n                return;\n            }\n\n            const docname = selected[0].name;\n\n            // Construct the URL for printing\n            const print_url = `/app/print/Sales%20Invoice/${encodeURIComponent(docname)}`;\n\n            // Open the URL in a new tab\n            const print_window = window.open(print_url, '_blank');\n\n            // Validate pop-up blockers\n            if (!print_window) {\n                frappe.msgprint(__('Please enable pop-ups in your browser to open the print view.'));\n            }\n        });\n        \n        // Add \"pdf Record\" Button\n        listview.page.add_action_item(__('Pdf'), function () {\n            // Get the selected records\n            const selected = listview.get_checked_items();\n\n            // Validate that exactly one record is selected\n            if (selected.length !== 1) {\n                frappe.msgprint(__('Please select exactly one record to PDF.'));\n                return;\n            }\n\n            const docname = selected[0].name;\n\n            var objWindowOpenResult = window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n              + \"doctype=\" + encodeURIComponent(\"Sales Invoice\")\n              + \"&name=\" + encodeURIComponent(docname)\n              + \"&trigger_print=0\"\n              + \"&format=Test Issue Voucher(Delivery Challan)\"\n              + \"&no_letterhead=0\"\n              + \"&_lang=en\"\n            ));\n\n            if(!objWindowOpenResult) {\n              msgprint(__(\"Please set permission for pop-up windows in your browser!\")); return;\n            }\n        });\n        \n        // Add \"Whatsapp Record\" Button\n        listview.page.add_action_item(__('Whatsapp'), function () {\n            // Get the selected records\n            const selected = listview.get_checked_items();\n\n            // Validate that exactly one record is selected\n            if (selected.length !== 1) {\n                frappe.msgprint(__('Please select exactly one record to sen whatsapp messgae.'));\n                return;\n            }\n\n            const docname = selected[0].name;\n\n            frappe.call({\n                        method: 'ascra_billing.ascra_billing.doc_events.sales_invoice.send_whatsapp_msg',\n                        args: {\n                            phone_number: '7208283676',\n                            header_values: [\"ASCRA TECHNOLOGIES\"],\n                            body_values: [docname],\n                            button_values: [\"256661\"]\n                        },\n                        callback: function(r) {\n                            if (r.message && r.message.success) {\n                                frappe.msgprint(__('Message sent successfully.'));\n                            } else {\n                                frappe.msgprint(__('Failed to send message. Details: ') + r.message.error);\n                            }\n                        }\n                    });\n        });\n    }\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-02-26 12:12:15.461551",
  "module": "Ascra Billing",
  "name": "Sales invoice",
  "script": "frappe.ui.form.on('Sales Invoice', {\n    refresh: function (frm) {\n        // This function will run when the form is refreshed\n        // You can initialize or manipulate fields here if needed\n    },\n    onload: function (frm) {\n        \n    },\n    custom_sales_type : function (frm) {\n        if(frm.doc.custom_sales_type==\"Labour Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"LB\");\n        }\n        else if(frm.doc.custom_sales_type==\"On Approval\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"OAI\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Rent Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"RB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Invoice\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"IB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Bill Heading\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"BH\");\n        }\n        else if(frm.doc.custom_sales_type==\"Hallmark Issue\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"HI\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Debit Note\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SDN\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Credit Note\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SCN\");\n        }\n        else if(frm.doc.custom_sales_type==\"Issue Voucher\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"IV\");\n        }\n        else if(frm.doc.custom_sales_type==\"Delivery Challan\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"DC\");\n        }\n        else if(frm.doc.custom_sales_type==\"Bill Heading\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"BH\");\n        }\n    }\n});\nfrappe.ui.form.on('Sales Invoice', {\n    before_save: function(frm) {\n        if (frm.doc.custom_sales_type==\"On Approval\" || frm.doc.custom_sales_type==\"Issue Voucher\" || frm.doc.custom_sales_type==\"Hallmark Issue\" || frm.doc.custom_sales_type==\"Delivery Challan\") {\n            // Remove TCS related fields if the condition is not met\n            frm.doc.tcs_amount = 0;\n            frm.doc.tcs_rate = 0;\n            frm.refresh_fields(); // Refresh the form to apply changes\n        }\n        if(frm.doc.custom_sales_type==\"Labour Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"LB\");\n        }\n        else if(frm.doc.custom_sales_type==\"On Approval\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"OAI\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Rent Bill\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"RB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Invoice\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"IB\");\n        }\n        else if(frm.doc.custom_sales_type==\"Bill Heading\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"BH\");\n        }\n        else if(frm.doc.custom_sales_type==\"Hallmark Issue\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"HI\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Debit Note\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SDN\");\n        }\n        else if(frm.doc.custom_sales_type==\"Sales Credit Note\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"SCN\");\n        }\n        else if(frm.doc.custom_sales_type==\"Issue Voucher\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"IV\");\n        }\n        else if(frm.doc.custom_sales_type==\"Delivery Challan\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"DC\");\n        }\n        else if(frm.doc.custom_sales_type==\"Bill Heading\") {\n            frm.set_value(\"custom_sales_type_prefix\", \"BH\");\n        }\n    },\n});\nfrappe.ui.form.on('Sales Invoice', {\n    refresh(frm) {\n        setTimeout(() => {\n            frm.remove_custom_button('Quality Inspection(s)', 'Create');\n            frm.remove_custom_button('Fetch Timesheet');\n            }, 10);\n    }\n});\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\n    cur_frm.set_value(\"custom_created_by\", frm.doc.owner);\n});\n\nfrappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tfrm.set_query(\"custom_sales_type\", function() {\n        return {\n            \"filters\": {\n                \"custom_sales\": 1,\n            }\n        };\n    });\n\t}\n})\n\n\n\n\n\n\n\n\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2025-02-26 12:12:28.623224",
  "module": "Ascra Billing",
  "name": "Purchase Invoice",
  "script": "frappe.ui.form.on('Purchase Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tfrm.set_query(\"custom_sales_type\", function() {\n        return {\n            \"filters\": {\n                \"custom_purchase\": 1,\n            }\n        };\n    });\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Issue Voucher",
  "enabled": 1,
  "modified": "2025-02-26 12:12:43.494570",
  "module": "Ascra Billing",
  "name": "Sales issue Voucher Filter Script",
  "script": "frappe.ui.form.on('Sales Issue Voucher', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tfrm.set_query(\"voucher_billing_dept_cat_type\", function () {\n            return {\n                filters: {\n                    'custom_sales': ['=', '1'],\n                },\n            };\n        });\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Receipt Voucher",
  "enabled": 1,
  "modified": "2025-02-26 12:12:56.263696",
  "module": "Ascra Billing",
  "name": "Sales Receipt Voucher",
  "script": "frappe.ui.form.on('Sales Receipt Voucher', {\n    refresh(frm) {\n        frm.set_query(\"voucher_billing_dept_cat_type\", function() {\n            return {\n                filters: {\n                    custom_purchase: 1 // Use 1 instead of true if it's an Int field\n                }\n            };\n        });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-02-26 12:13:10.837980",
  "module": "Ascra Billing",
  "name": "sales invoice v2",
  "script": "frappe.ui.form.on('Sales Invoice', {\n    onload: function(frm) {\n        initial_tax_setup(frm);\n    },\n    refresh: function(frm) {\n       if (frm.doc.docstatus === 0) {\n         initial_tax_setup(frm);\n       }\n    },\n    items_add: function(frm, cdt, cdn) {\n        trigger_tax_recalculation(frm);\n    },\n    items_remove: function(frm, cdt, cdn) {\n        trigger_tax_recalculation(frm);\n    },\n    item_code: function(frm, cdt, cdn) {\n        trigger_tax_recalculation(frm);\n    },\n    qty: function(frm, cdt, cdn) {\n        trigger_tax_recalculation(frm);\n    },\n    rate: function(frm, cdt, cdn) {\n        trigger_tax_recalculation(frm);\n    },\n    tax_category: function(frm) {\n        trigger_tax_recalculation(frm);\n    },\n    taxes_and_charges: function(frm) {\n        trigger_tax_recalculation(frm);\n    },\n    validate: function(frm) {\n        trigger_tax_recalculation(frm);\n        \n        //Always calculate before final save\n    }\n});\n\nfunction initial_tax_setup(frm) {\n    if (frm.doc.taxes_and_charges &&\n        frm.doc.items && frm.doc.items.length > 0 &&\n        (!frm.doc.taxes || frm.doc.taxes.length === 0) && frm.doc.docstatus === 0) {\n\n        let current_template = frm.doc.taxes_and_charges;\n        frm.set_value(\"taxes_and_charges\", \"\")\n            .then(() => {\n                frm.set_value(\"taxes_and_charges\", current_template);\n            });\n    }\n}\n\nfunction trigger_tax_recalculation(frm) {\n    if (!frm.doc.taxes_and_charges || !frm.doc.items || frm.doc.items.length === 0) {\n        return;\n    }\n\n    if (frm.doc.docstatus != 0) {\n        return;\n    }\n\n    // Correct Method Path:\n \n}\n\nfrappe.ui.form.on('Sales Invoice Item', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tcustom_item:function(frm){\n\t    initial_tax_setup(frm)\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Follow-Up",
  "enabled": 1,
  "modified": "2025-02-26 12:13:45.789387",
  "module": null,
  "name": "Follow-Up",
  "script": "frappe.listview_settings['Follow-Up'] = { // And other doctype names\n    hide_name_column: true\n}",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-02-26 12:13:57.601069",
  "module": "Ascra Billing",
  "name": "tax round",
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tafter_save: function(frm) {\n\t    console.log('rrrrrrr')\n        frm.doc.taxes.forEach((row) =>{\n            console.log('--------------vv')\n            if (row.account_head === 'TDS Payable - A') {\n                console.log(row.tax_amount)\n                row.tax_amount = Math.round(row.tax_amount); // Rounds to nearest integer\n                row.total = Math.round(row.total);\n            }\n        })       \n    }\n})",
  "view": "Form"
 }
]